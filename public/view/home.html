<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
            <meta content="ThemeStarz" name="author">
                <title>
                    Peta Wisata Kota Batu
                </title>
                <!-- FONT -->
                <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet"/>
                <link href="https://fonts.googleapis.com/css?family=Signika+Negative" rel="stylesheet"/>
                <link href="{{baseUrl}}/public/css/font-awesome.min.css" rel="stylesheet"/>
                <!-- CORE -->
                <link href="{{baseUrl}}/public/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
                <link href="{{baseUrl}}/public/css/jquery.slider.min.css" rel="stylesheet" type="text/css"/>
                <link href="{{baseUrl}}/public/css/style.css" rel="stylesheet" type="text/css"/>
            </meta>
        </meta>
    </head>
    <body class="page-homepage map-google" data-offset="90" data-spy="scroll" data-target=".navigation" id="page-top">
        <div class="wrapper">
            <div class="navigation">
                <div class="container">
                    <header class="navbar" id="top" role="banner">
                        <div class="navbar-header">
                            <button class="navbar-toggle" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button">
                                <span class="sr-only">
                                    Toggle navigation
                                </span>
                                <span class="icon-bar">
                                </span>
                                <span class="icon-bar">
                                </span>
                                <span class="icon-bar">
                                </span>
                            </button>
                            <div class="navbar-brand nav" id="brand">
                                <a href="{{path_for('index')}}">
                                    <span class="logo-styled">
                                        <span class="logo-title">
                                            <img alt="" src="{{baseUrl}}/public/images/logo.png">
                                                Batu
                                            </img>
                                        </span>
                                        <span class="logo-subtitle hidden-sm">
                                            Tourism
                                            <br>
                                                Map
                                            </br>
                                        </span>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <nav class="collapse navbar-collapse bs-navbar-collapse navbar-right" role="navigation">
                            {% include 'layout/menu.html' %}
                        </nav>
                    </header>
                </div>
            </div>
            <div class="container">
                <div class="geo-location-wrapper">
                    <span class="btn btn-primary geo-location">
                        <i class="fa fa-map-marker">
                        </i>
                        <span class="text">
                            Lokasi Saya
                        </span>
                    </span>
                </div>
            </div>
            <div class="map-canvas">
                <div class="map">
                    <div id="map">
                    </div>
                    <div class="search-bar horizontal">
                        <form class="form-inline" method="GET" role="form">
                            <center>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <input class="form-control form-search" placeholder="Kata Kunci Pencarian" type="text">
                                            </input>
                                        </div>
                                        <div class="form-group">
                                            <select class="form-control form-search" name="kategori">
                                                <option value="">
                                                    .: Semua Kategori :.
                                                </option>
                                                <option value="w">
                                                    Wisata Alam
                                                </option>
                                                <option value="s">
                                                    Wisata Keluarga
                                                </option>
                                            </select>
                                        </div>
                                        <div class="form-group" style="width: initial;">
                                            <button class="btn btn-default" style="padding: 9px 15px;" type="submit">
                                                <i class="fa fa-search">
                                                </i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </center>
                        </form>
                    </div>
                </div>
            </div>
            <footer id="page-footer">
                <div class="inner">
                    <aside id="footer-copyright">
                        <div class="container">
                            <span>
                                Copyright Â© 2017. All Rights Reserved.
                            </span>
                            <span class="pull-right">
                                <a class="roll" href="#page-top">
                                    Go to top
                                </a>
                            </span>
                        </div>
                    </aside>
                </div>
            </footer>
        </div>
        <script src="{{baseUrl}}/public/js/jquery-2.1.0.min.js" type="text/javascript">
        </script>
        <script src="{{baseUrl}}/public/bootstrap/js/bootstrap.min.js" type="text/javascript">
        </script>
        <script src="{{baseUrl}}/public/js/smoothscroll.js" type="text/javascript">
        </script>
        <script src="{{baseUrl}}/public/js/custom.js" type="text/javascript">
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD6YYW2yTplkQfLOxBGk8ZkTPa3Gbckun0">
        </script>
        <script src="{{baseUrl}}/public/js/markerwithlabel_packed.js" type="text/javascript">
        </script>
        <script src="{{baseUrl}}/public/js/infobox.js" type="text/javascript">
        </script>
        <!-- <script src="{{baseUrl}}/public/js/map.js" type="text/javascript">
        </script> -->
        <script>
            function createHomepageGoogleMap(_url, _latitude, _longitude) {
            var uluru = {
                lat: _latitude,
                lng: _longitude
            };
            var map = new google.maps.Map(document.getElementById('map'), {
                scrollwheel: false,
                zoom: 17,
                center: uluru,
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                    position: google.maps.ControlPosition.BOTTOM_CENTER
                },
                mapTypeId: 'roadmap',
                // styles: mapStyles
            });
            var infoWindow = new google.maps.InfoWindow;
            downloadUrl(_url + '/getloc.php', function(data) {
                var xml = data.responseXML;
                var markers = xml.documentElement.getElementsByTagName('marker');
                var newMarkers = [];
                var i = 0;
                Array.prototype.forEach.call(markers, function(markerElem) {
                    var name = markerElem.getAttribute('name');
                    var iconUrl = markerElem.getAttribute('icon');
                    var address = markerElem.getAttribute('address');
                    var type = markerElem.getAttribute('type');
                    var point = new google.maps.LatLng(parseFloat(markerElem.getAttribute('lat')), parseFloat(markerElem.getAttribute('lng')));
                    var infowincontent = document.createElement('div');
                    var pictureLabel = document.createElement("img");
                    pictureLabel.src = _url + '/public/images/noimage.jpg';
                    infowincontent.innerHTML = '<div class="infobox-inner">' + '<a href="">' + '<div class="infobox-image" style="position: relative; max-width: 250px;">' + '<img src="' + _url + '/public/images/noimage.jpg" style="margin-top: -20%;">' + '<div><span class="infobox-price">'+ name +'</span></div>' + '</div>' + '</a>' + '<div class="infobox-description">' + '<div class="infobox-title"><a href="">'+ address +'</a></div>' + '<div class="infobox-location" style="margin-top:10px;">' + '<a class="btn btn-primary" href="#" style="width: 48%"><span class="fa fa-search"></span> Detail</a>' + '<a class="btn btn-primary" href="#" style="width: 50%; float: right;"><span class="fa fa-eye"></span> Lihat Rute</a>' + '</div>' + '</div>' + '</div>';
                    infoboxOptions = {
                        content: infowincontent,
                        disableAutoPan: false,
                        pixelOffset: new google.maps.Size(-100, 0),
                        zIndex: null,
                        alignBottom: true,
                        boxClass: "infobox-wrapper",
                        enableEventPropagation: true,
                        closeBoxMargin: "0px 0px -8px 0px",
                        closeBoxURL: _url + "/public/images/map/close-btn.png",
                        infoBoxClearance: new google.maps.Size(1, 1)
                    };
                    var imageIcon = new google.maps.MarkerImage(iconUrl, new google.maps.Size(71, 71), new google.maps.Point(0, 0), new google.maps.Point(17, 34), new google.maps.Size(42, 42));
                    var marker = new google.maps.Marker({
                        title: name,
                        position: new google.maps.LatLng(markerElem.getAttribute('lat'), markerElem.getAttribute('lng')),
                        map: map,
                        icon: imageIcon,
                    });
                    newMarkers.push(marker);
                    newMarkers[i].infobox = new InfoBox(infoboxOptions);
                    google.maps.event.addListener(marker, 'click', (function(marker, i) {
                        return function() {
                            for (h = 0; h < newMarkers.length; h++) {
                                newMarkers[h].infobox.close();
                            }
                            newMarkers[i].infobox.open(map, this);
                        }
                    })(marker, i));
                    i++;
                });
            });

            function downloadUrl(url, callback) {
                var request = window.ActiveXObject ? new ActiveXObject('Microsoft.XMLHTTP') : new XMLHttpRequest;
                request.onreadystatechange = function() {
                    if (request.readyState == 4) {
                        request.onreadystatechange = doNothing;
                        callback(request, request.status);
                    }
                };
                request.open('GET', url, true);
                request.send(null);
            }

            function doNothing() {}
        }

        $(document).ready(function($) {
            createHomepageGoogleMap("{{baseUrl}}", -7.871162, 112.526753);
        });
        </script>
    </body>
</html>